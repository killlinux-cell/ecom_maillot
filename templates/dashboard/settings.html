{% extends 'dashboard/base.html' %}

{% block title %}Paramètres - Dashboard{% endblock %}
{% block page_title %}Paramètres du Système{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-8">
        <h2><i class="fas fa-cog"></i> Paramètres du Système</h2>
        <p class="text-muted">Configurez les paramètres de votre boutique de maillots</p>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <!-- Paramètres généraux -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-sliders-h"></i> Paramètres Généraux</h5>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="site_name" class="form-label">Nom du site</label>
                            <input type="text" class="form-control" id="site_name" name="site_name" 
                                   value="Ecom Maillot" readonly>
                            <small class="text-muted">Nom de votre boutique</small>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="site_url" class="form-label">URL du site</label>
                            <input type="url" class="form-control" id="site_url" name="site_url" 
                                   value="{{ request.scheme }}://{{ request.get_host }}" readonly>
                            <small class="text-muted">Adresse de votre site</small>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="currency" class="form-label">Devise</label>
                            <select class="form-select" id="currency" name="currency">
                                <option value="FCFA" selected>Franc CFA (FCFA)</option>
                                <option value="EUR">Euro (EUR)</option>
                                <option value="USD">Dollar US (USD)</option>
                                <option value="GBP">Livre Sterling (GBP)</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="language" class="form-label">Langue</label>
                            <select class="form-select" id="language" name="language">
                                <option value="fr" selected>Français</option>
                                <option value="en">English</option>
                                <option value="es">Español</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="timezone" class="form-label">Fuseau horaire</label>
                            <select class="form-select" id="timezone" name="timezone">
                                <option value="Africa/Abidjan" selected>Afrique/Abidjan (GMT+0)</option>
                                <option value="Europe/Paris">Europe/Paris (GMT+1/+2)</option>
                                <option value="America/New_York">America/New_York (GMT-5/-4)</option>
                                <option value="Asia/Tokyo">Asia/Tokyo (GMT+9)</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="date_format" class="form-label">Format de date</label>
                            <select class="form-select" id="date_format" name="date_format">
                                <option value="d/m/Y" selected>JJ/MM/AAAA</option>
                                <option value="Y-m-d">AAAA-MM-JJ</option>
                                <option value="m/d/Y">MM/JJ/AAAA</option>
                            </select>
                        </div>
                    </div>
                    
                    <hr class="my-4">
                    
                    <button type="submit" class="btn btn-primary btn-custom">
                        <i class="fas fa-save"></i> Sauvegarder les paramètres
                    </button>
                </form>
            </div>
        </div>
        
        <!-- Paramètres de paiement -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-credit-card"></i> Paramètres de Paiement</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="wave_enabled" class="form-label">Paiement Wave</label>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="wave_enabled" name="wave_enabled" checked>
                            <label class="form-check-label" for="wave_enabled">
                                Activer les paiements Wave
                            </label>
                        </div>
                        <small class="text-muted">Paiement mobile par Wave</small>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <label for="paydunya_enabled" class="form-label">Paiement PayDunya</label>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="paydunya_enabled" name="paydunya_enabled">
                            <label class="form-check-label" for="paydunya_enabled">
                                Activer les paiements PayDunya
                            </label>
                        </div>
                        <small class="text-muted">Paiement en ligne sécurisé</small>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="cash_on_delivery" class="form-label">Paiement à la livraison</label>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="cash_on_delivery" name="cash_on_delivery" checked>
                            <label class="form-check-label" for="cash_on_delivery">
                                Activer le paiement à la livraison
                            </label>
                        </div>
                        <small class="text-muted">Paiement en espèces à la réception</small>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <label for="bank_transfer" class="form-label">Virement bancaire</label>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="bank_transfer" name="bank_transfer">
                            <label class="form-check-label" for="bank_transfer">
                                Activer les virements bancaires
                            </label>
                        </div>
                        <small class="text-muted">Paiement par virement</small>
                    </div>
                </div>
                
                <hr class="my-4">
                
                <button type="submit" class="btn btn-primary btn-custom">
                    <i class="fas fa-save"></i> Sauvegarder les paramètres de paiement
                </button>
            </div>
        </div>
        
        <!-- Paramètres de livraison -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-shipping-fast"></i> Paramètres de Livraison</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="delivery_fee" class="form-label">Frais de livraison (FCFA)</label>
                        <input type="number" class="form-control" id="delivery_fee" name="delivery_fee" 
                               value="1000" min="0" step="100">
                        <small class="text-muted">Frais de livraison par défaut</small>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <label for="free_delivery_threshold" class="form-label">Seuil livraison gratuite (FCFA)</label>
                        <input type="number" class="form-control" id="free_delivery_threshold" name="free_delivery_threshold" 
                               value="25000" min="0" step="1000">
                        <small class="text-muted">Montant minimum pour la livraison gratuite</small>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="delivery_time_min" class="form-label">Délai de livraison min (jours)</label>
                        <input type="number" class="form-control" id="delivery_time_min" name="delivery_time_min" 
                               value="1" min="1" max="30">
                        <small class="text-muted">Délai minimum de livraison</small>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <label for="delivery_time_max" class="form-label">Délai de livraison max (jours)</label>
                        <input type="number" class="form-control" id="delivery_time_max" name="delivery_time_max" 
                               value="7" min="1" max="30">
                        <small class="text-muted">Délai maximum de livraison</small>
                    </div>
                </div>
                
                <hr class="my-4">
                
                <button type="submit" class="btn btn-primary btn-custom">
                    <i class="fas fa-save"></i> Sauvegarder les paramètres de livraison
                </button>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <!-- Informations système -->
        <div class="card mb-4">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-info-circle"></i> Informations Système</h6>
            </div>
            <div class="card-body">
                <ul class="list-unstyled">
                    <li class="mb-2">
                        <strong>Version Django:</strong><br>
                        <span class="text-muted">{{ django_version|default:"4.2.7" }}</span>
                    </li>
                    <li class="mb-2">
                        <strong>Version Python:</strong><br>
                        <span class="text-muted">{{ python_version|default:"3.8+" }}</span>
                    </li>
                    <li class="mb-2">
                        <strong>Base de données:</strong><br>
                        <span class="text-muted">SQLite</span>
                    </li>
                    <li class="mb-2">
                        <strong>Mode debug:</strong><br>
                        <span class="badge {% if debug %}bg-warning{% else %}bg-success{% endif %}">
                            {{ debug|yesno:"Activé,Désactivé" }}
                        </span>
                    </li>
                    <li class="mb-2">
                        <strong>Environnement:</strong><br>
                        <span class="badge bg-info">{{ environment|default:"Production" }}</span>
                    </li>
                </ul>
            </div>
        </div>
        
        <!-- Actions système -->
        <div class="card mb-4">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-tools"></i> Actions Système</h6>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <button class="btn btn-outline-primary btn-sm" onclick="clearCache()">
                        <i class="fas fa-broom"></i> Vider le cache
                    </button>
                    
                    <button class="btn btn-outline-secondary btn-sm" onclick="collectStatic()">
                        <i class="fas fa-folder-open"></i> Collecter les fichiers statiques
                    </button>
                    
                    <button class="btn btn-outline-info btn-sm" onclick="checkSystem()">
                        <i class="fas fa-stethoscope"></i> Vérifier le système
                    </button>
                    
                    <button class="btn btn-outline-warning btn-sm" onclick="backupDatabase()">
                        <i class="fas fa-download"></i> Sauvegarder la base
                    </button>
                    
                    <button class="btn btn-outline-danger btn-sm" onclick="restartSystem()">
                        <i class="fas fa-redo"></i> Redémarrer le système
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Statut des services -->
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-server"></i> Statut des Services</h6>
            </div>
            <div class="card-body">
                <div class="mb-2">
                    <span class="badge bg-success me-2">●</span>
                    <span>Base de données</span>
                </div>
                <div class="mb-2">
                    <span class="badge bg-success me-2">●</span>
                    <span>Fichiers statiques</span>
                </div>
                <div class="mb-2">
                    <span class="badge bg-success me-2">●</span>
                    <span>Médias</span>
                </div>
                <div class="mb-2">
                    <span class="badge bg-success me-2">●</span>
                    <span>Cache</span>
                </div>
                <div class="mb-2">
                    <span class="badge bg-success me-2">●</span>
                    <span>Email</span>
                </div>
                <div class="mb-2">
                    <span class="badge bg-success me-2">●</span>
                    <span>Paiements</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function clearCache() {
    if (confirm('Êtes-vous sûr de vouloir vider le cache ?')) {
        // Ici vous pouvez ajouter une requête AJAX pour vider le cache
        alert('Cache vidé avec succès!');
    }
}

function collectStatic() {
    if (confirm('Voulez-vous collecter les fichiers statiques ?')) {
        // Ici vous pouvez ajouter une requête AJAX pour collecter les fichiers statiques
        alert('Fichiers statiques collectés avec succès!');
    }
}

function checkSystem() {
    // Ici vous pouvez ajouter une requête AJAX pour vérifier le système
    alert('Vérification du système en cours...');
}

function backupDatabase() {
    if (confirm('Voulez-vous sauvegarder la base de données ?')) {
        // Ici vous pouvez ajouter une requête AJAX pour sauvegarder la base
        alert('Sauvegarde de la base de données en cours...');
    }
}

function restartSystem() {
    if (confirm('ATTENTION: Voulez-vous vraiment redémarrer le système ?')) {
        if (confirm('Cette action redémarrera complètement le système. Continuer ?')) {
            // Ici vous pouvez ajouter une requête AJAX pour redémarrer le système
            alert('Redémarrage du système en cours...');
        }
    }
}

// Validation des paramètres
document.addEventListener('DOMContentLoaded', function() {
    const deliveryTimeMin = document.getElementById('delivery_time_min');
    const deliveryTimeMax = document.getElementById('delivery_time_max');
    
    deliveryTimeMin.addEventListener('change', function() {
        const min = parseInt(this.value);
        const max = parseInt(deliveryTimeMax.value);
        
        if (min > max) {
            deliveryTimeMax.value = min;
        }
    });
    
    deliveryTimeMax.addEventListener('change', function() {
        const max = parseInt(this.value);
        const min = parseInt(deliveryTimeMin.value);
        
        if (max < min) {
            deliveryTimeMin.value = max;
        }
    });
});
</script>
{% endblock %}
